@page "/"
@inject SimplAgentApiClient AgentClient

<PageTitle>Home</PageTitle>

<h1>Hello, world!</h1>

<p>Welcome to your new app.</p>

<div class="chat-container" style="max-width:500px;">
    <div class="chat-messages" style="border:1px solid #ccc; padding:10px; min-height:200px; overflow-y:auto;">
        @foreach (var msg in Messages)
        {
            <div>
                <strong>@msg.Role:</strong> @msg.Content
            </div>
        }
    </div>

    <div class="chat-input" style="margin-top:10px; display:flex;">
        @* <input @bind="UserInput" @bind:event="oninput" class="form-control" placeholder="Type your message..." /> *@
        <button class="btn btn-primary" style="margin-left:5px;" @onclick="SendMessage">Send</button>
    </div>

</div>

@code {
    private string UserInput = string.Empty;
    private List<ChatMessage> Messages = new List<ChatMessage>();

private async Task SendMessage()
    {
        if (string.IsNullOrWhiteSpace(UserInput))
            return;

        // Add user message to chat
        Messages.Add(new ChatMessage { Role = "User", Content = UserInput });

        var userMessage = UserInput;
        UserInput = string.Empty;

        // Send to agentClient
        var response = await AgentClient.ChatAsync(userMessage);

        // Add agent response
        Messages.Add(new ChatMessage { Role = "Agent", Content = response ?? "No Response" });
    }

    private class ChatMessage
    {
        public string Role { get; set; } = string.Empty;
        public string Content { get; set; } = string.Empty;
    }

}
